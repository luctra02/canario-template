# ========================
#  HAProxy Configuration
#  Project Canario 2025
# ========================

global
    log /dev/log local0
    log /dev/log local1 notice
    maxconn 2048
    user haproxy
    group haproxy
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5s
    timeout client  30s
    timeout server  30s

# === Frontend ===
frontend http_front
    bind *:80
    mode http

    # All requests (/, /flags, etc.) go to the same backend
    default_backend canario_web_backend

# === Backend: Web + Feature Flags ===
backend canario_web_backend
    mode http
    balance roundrobin
    option httpchk GET /
<<<<<<< HEAD
    server web1 127.0.0.1:8080 check
=======
    # Your Node container running on Webserver VM
    server web1 192.168.47.100:8080 check
>>>>>>> parent of 9f5f698 (change backend address to localhost ip for the vm and healthcheck to flags endpoint)

# === Stats Dashboard (optional) ===
listen stats
    bind *:1936
    mode http
    stats enable
    stats uri /
    stats refresh 10s
    stats auth admin:admin
