# ========================
#  HAProxy Configuration
#  Project Canario 2025
# ========================

global
    log /dev/log local0
    log /dev/log local1 notice
    maxconn 2048
    user haproxy
    group haproxy
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5s
    timeout client  30s
    timeout server  30s

# === Frontend ===
frontend http_front
    bind *:80
    mode http

    # Route all traffic to backend
    default_backend canario_web_backend

# === Backend: Web + Feature Flags ===
backend canario_web_backend
    mode http
    balance roundrobin
    option httpchk GET /flags
    server web1 127.0.0.1:8080 check

# === Stats Dashboard (optional) ===
listen stats
    bind *:1936
    mode http
    stats enable
    stats uri /
    stats refresh 10s
    stats auth admin:admin
