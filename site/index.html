<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Canario Template</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
   <body>
    <div class="container">
      <h1>Welcome to Canario!</h1>
      <p id="flag-status">Checking feature flag...</p>
      <button onclick="checkFeatureFlag()">Refresh Flag</button>
    </div>

    <script>
      // These will be replaced by your Dockerfile using sed
      const FLAG_PROXY_URL = "__FLAG_PROXY_URL__";
      const FEATURE_FLAG_NAME = "__FEATURE_FLAG_NAME__";

      async function checkFeatureFlag() {
        const status = document.getElementById("flag-status");

        try {
          const res = await fetch(FLAG_PROXY_URL, { cache: "no-store" });
          if (!res.ok) throw new Error("Flag proxy error");

          const data = await res.json();
          // Example: data = { "flag1": true, "flag2": false }

          if (!data.hasOwnProperty(FEATURE_FLAG_NAME)) {
            throw new Error(`Feature flag "${FEATURE_FLAG_NAME}" not found in response`);
          }

          const isActive = Boolean(data[FEATURE_FLAG_NAME]);

          if (isActive) {
            document.body.classList.add("flag-on");
            document.body.classList.remove("flag-off");
            status.innerHTML = `Feature <b>${FEATURE_FLAG_NAME}</b> is <b>ON</b>!`;
          } else {
            document.body.classList.add("flag-off");
            document.body.classList.remove("flag-on");
            status.innerHTML = `Feature <b>${FEATURE_FLAG_NAME}</b> is <b>OFF</b>.`;
          }
        } catch (error) {
          console.error(error);
          document.body.classList.remove("flag-on", "flag-off");
          status.innerHTML = "Could not fetch feature flag state.";
        }
      }

      // Check on page load
      checkFeatureFlag();
    </script>
  </body>
</html>
