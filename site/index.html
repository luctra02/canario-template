<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Canario Template</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>Welcome to Canario!</h1>
      <p id="flag-status">Checking feature flag...</p>
      <button onclick="checkFeatureFlag()">Refresh Flag</button>
    </div>

    <script>

      const FLAG_PROXY_URL = "__FLAG_PROXY_URL__";
      const FEATURE_FLAG_NAME = "__FEATURE_FLAG_NAME__";

      async function checkFeatureFlag() {
        const status = document.getElementById("flag-status");
        try {
          const res = await fetch(FLAG_PROXY_URL, { cache: "no-store" });
          if (!res.ok) throw new Error("Flag proxy error");
          const data = await res.json(); // { flagName: true/false }
          const isActive = !!data[FEATURE_FLAG_NAME];

          if (isActive) {
            document.body.classList.add("flag-on");
            document.body.classList.remove("flag-off");
            status.innerHTML = `üéâ Feature <b>${FEATURE_FLAG_NAME}</b> is <b>ON</b>!`;
          } else {
            document.body.classList.add("flag-off");
            document.body.classList.remove("flag-on");
            status.innerHTML = `üöß Feature <b>${FEATURE_FLAG_NAME}</b> is <b>OFF</b>.`;
          }
        } catch (e) {
          console.error(e);
          status.textContent = "‚ùå Could not fetch feature flag state.";
        }
      }

      checkFeatureFlag();
    </script>
  </body>
</html>
